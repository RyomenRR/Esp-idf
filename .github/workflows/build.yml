name: Build ESP32 RainMaker 4-Channel Relay

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: espressif/idf:release-v5.3

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install IDF Component Manager
        run: |
          python -m pip install --upgrade pip
          pip install idf-component-manager

      - name: Build Project
        run: |
          . $IDF_PATH/export.sh
          idf.py set-target esp32
          idf.py reconfigure    # ‚Üê This automatically downloads esp_rmaker
          idf.py build

      - name: Upload Firmware
        uses: actions/upload-artifact@v4
        with:
          name: ESP32-4CH-Relay-Firmware
          path: |
            build/*.bin
            build/flash_args
          retention-days: 30